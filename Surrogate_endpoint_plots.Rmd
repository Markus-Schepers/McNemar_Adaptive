---
title: "McNemar Adaptive Design â€” Surrogate endpoint plots"
output: html_document
author: Markus Schepers
---

```{r setup, echo = FALSE, include=FALSE}
#knitr::opts_chunk$set(warning=FALSE,message=FALSE,fig.path = "figs/")

set.seed(1)

library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)

source("Conditional-Power-McNemar.R")
Sys.setlocale("LC_CTYPE", "en_US.UTF-8")

```


# Scenario 1


```{r scenario1setup}
target_power <- 0.8
alpha <- 0.05

psi <- 0.2
p_star <- 0.875
theta_d <- 0.9
theta_c <- 0.1

#alternatively estimate theta from interim data
#temp <- estimate_theta(5,1,2,17,pseudo = 0)
#theta_d <- temp[1]
#theta_c <- temp[2]

n1 <- 25
nd1 <- 3
m1 <- 38
m_d_SP <- 2
n2 <- 38
nsecond_max <- 200

power_surrogate(p_star, psi,theta_d, theta_c,nd1,
                            n1,
                            m1,
                            m_d_SP,
                            n2,
                            alpha)
min_nsecond_surrogate(p_star, psi,
    theta_d, theta_c,
    nd1,
    n1,
    m1,
    m_d_SP,
    target_power = 0.8,
    alpha = 0.05,
    nsecond_max =nsecond_max)
```

# Conditional power and total sample size depending on discordant pairs among surrogate-only patients

```{r scenario1, echo=FALSE}
cp_surr_vals <- vapply(0:13,
                       function(k)
                         power_surrogate(p_star=0.875, psi,theta_d, theta_c,nd1,
                            n1,
                            m1,
                            k,
                            n2,
                            alpha)
                       ,numeric(1))


cp_surr_vals

n2_surr_vals <- vapply(0:13,
                       function(k)
                         min_nsecond_surrogate(p_star, psi,
    theta_d, theta_c,
    nd1,
    n1,
    m1,
    k,
    target_power = 0.8,
    alpha = 0.05,
    nsecond_max = 200
),numeric(1))

n2_surr_vals
```



